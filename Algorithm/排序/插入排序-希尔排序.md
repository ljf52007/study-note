希尔排序是对直接插入排序的一种改进.

## 算法过程

```
(从小到大排序)
1. 选择一个递减的增量序列t1, t2, ... , tk,其中序列尾项,即tk必为1
2. 以t1为增量,将待排数列划分为若干个子序列,分别对这若干个子序列进行直接插入排序,得到新的待排数列
3. 以t2为增量,将待排数列划分为若干个子序列,分别对这若干个子序列进行直接插入排序,得到新的待排数列
4. 以此类推,直到以tk为增量,即增量为1,此时待排数列本身进行直接插入排序,得到排序后的数列
```



## 排序演示

算法过程讲起来比较抽象,来看一个希尔排序的例子.

对下面的数列进行希尔排序

```
3, 4, 6, 9, 5, 7, 8, 1, 2, 10
```

确定增量序列,一般是以待排数列的长度来决定.

这里,我们以待排数列长度除以`2`并向下取整,确定增量序列的首项,即

```
⌊10 / 2⌋ = 5
```

再根据`t(i) = ⌊t(i-1) / 2⌋`得到增量序列为

```
5, 2, 1
```

**开始第一轮排序**,增量为`5`,待排数列被划分为`5`组`a,b,c,d,e`,其中`a`组子数列为`[3, 7]`,`b`组子数列为`[4, 8]`,`c`组子数列为`[6, 1]`,`d`组子数列为`[9, 2]`,`e`组子数列为`[5, 10]`

```
3, 4, 6, 9, 5, 7, 8, 1, 2, 10
a  b  c  d  e  a  b  c  d  e
```

分别对`a,b,c,d,e`五组子数列进行直接插入排序,得到新的待排数列

```
3, 4, 1, 2, 5, 7, 8, 6, 9, 10
```

**开始第二轮排序**,增量为`2`,待排数列被划分为`2`组`a,b`,其中`a`组子数列为`[3, 1, 5, 8, 9]`,`b`组子数列为`[4, 2, 7, 6, 10]`

```
3, 4, 1, 2, 5, 7, 8, 6, 9, 10
a  b  a  b  a  b  a  b  a  b
```

分别对`a,b`两组子数列进行直接插入排序,得到新的待排数列

```
1, 2, 3, 4, 5, 6, 8, 7, 9, 10
```

**开始第三轮排序**,增量为`1`,直接对待排数列进行直接插入排序,得到排序后的数列

```
1, 2, 3, 4, 5, 6, 7, 8, 9, 10
```



## 代码实现

```js
const arr = [3, 4, 6, 11, 9, 5, 7, 8, 1, 2, 10];

function shellSort(arr) {
  // 缓存数组长度
  let len = arr.length;
  // 初始化增量序列首项
  let increment = Math.floor(len / 2);
  // 外层循环增量序列
  for (increment; increment > 0; increment = Math.floor(increment / 2)) {
    // 巧妙地将划分子数列和对子数列进行直接插入排序结合
    for (let i = increment; i < len; i++) {
      let curValue = arr[i];
      // 外部定义变量j,这样不用在每一次循环都把curValue插入,只需要在循环结束后插入
      let j;
      // 将arr[j] > curValue写在循环的判断条件中,这样当不满足该条件时,循环就会被break,不会再往下进行比较(实际上相当于前面直接插入排序的if-else判断)
      for (j = i - increment; j >= 0 && arr[j] > curValue; j -= increment) {
        arr[j + increment] = arr[j];
      }
      arr[j + increment] = curValue;
    }
  }
  return arr;
}
```



## 性能分析

由希尔排序的算法过程可以知道,希尔排序的执行时间依赖于增量序列.好的增量序列有如下特征:

1. 最后一个增量必须为`1`;
2. 应该尽量避免序列中的值(尤其是相邻的值)互为倍数的情况;

希尔排序性能是优于直接插入排序的,为什么这么说?我们知道直接插入排序有两个特征:

1. 当`n`值较小时,`n`和`n^2`的差别较小,即直接插入排序的最好时间复杂度`O(n)`和最坏时间复杂度`O(n^2)`差别不大.
2. 原始待排数列基本有序时,直接插入排序所需的比较和移动次数较少;

希尔排序开始时,增量较大,分组较多,每组子数列的项数较少,因此各组子数列直接插入排序较快,这对应了直接插入排序的第一个特征.

希尔排序到后面增量越来越小,分组数较少,各组子数列的项数较多,但是由于前面的排序已经使得这些子数列基本有序,所以新的一趟直接插入排序也较快,这对应了直接插入排序的第二个特征.



## 稳定性

从希尔排序的排序过程可以看到,划分子数列并对子数列进行直接插入排序时,是很有可能打乱两个相等元素的先后顺序的,因此希尔排序是不稳定的.