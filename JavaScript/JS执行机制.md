## `JS`为什么单线程?

1. 首先区分进程与线程的概念.

   本质上来说,这两个名词都是`CPU`工作时间片上的一个描述.

   进程描述了`CPU`在运行指令及加载和保存上下文所需的时间,放在应用上来说就是一个程序.线程是进程中的更小单位,描述了执行一段指令所需的时间.

   把这些概念放到浏览器来说,浏览器是`多进程`的,我们打开一个`tab`页其实就是创建了一个进程.

   浏览器内核中有多种`线程`在工作,如

   - `GUI`渲染线程
   - `JS`引擎线程
   - 事件触发线程
   - 定时器触发线程
   - `http`请求线程

   比如,当我们发出一个请求时,其实就是创建了一个`http`请求线程,当请求结束后,该线程可能会被销毁.

2. `JS`为什么是单线程?

   `JavaScript`作为浏览器的脚本语言,主要用途是与用户互动,操作`DOM`等,这决定了它只能是单线程,否则会带来复杂的同步问题.

   比如,前面提到了`JS引擎线程和渲染线程`,这两个线程是互斥的,`JS`运行时可能会阻塞渲染.这是因为`JS`可以修改`DOM`,如果`JS`执行的时候渲染线程也在工作,就可能导致不能安全的渲染界面.例如,假如同时有两个线程在工作,一个线程在某个`DOM`节点上添加内容,另一个线程却删除了这个节点,这就导致了冲突.

   所以,单线程有单线程的好处,得益于`JS`是单线程运行的,可以达到节省内存,节约上下文切换时间,没有锁的问题等好处.

   

## 有什么办法多线程吗?

为了利用多核`CPU`的计算能力,`HTML5`提出了`Web Worker`标准,当我们使用这个类的时候,它就会向浏览器申请一个新的线程,这个线程就用来单独执行一个`JS`文件.

`Web Worker`允许`JavaScript`脚本创建多个线程.但是子线程完全受主线程的控制,且不得操作`DOM`.因此,这个类并没有改变`JavaScript`单线程的本质.



## 单线程带来的问题和解决方法

1. 单线程带来的问题

   `JavaScript`单线程就意味着,所有任务需要排队执行,前一个任务结束,才会执行下一个任务.这就容易造成阻塞.

   如果阻塞是因为计算量大,`CPU`忙不过来也就算了,但很多时候`CPU`是空闲的,因为`IO`设备(输入输出设备)比较慢(如`Ajax`请求),不得不等结果出来后再往下执行.

2. 解决单线程问题的方法

   `JavaScript`单线程中的任务分为`同步任务`和`异步任务`.同步任务会在`执行栈`中按照顺序排队等待`主线程`执行,异步任务则会在异步有了结果后将注册的回调函数添加到`任务队列(消息队列)`中,等待主线程空闲(也就是执行栈被清空)的时候,被读取到执行栈中等待主线程执行.